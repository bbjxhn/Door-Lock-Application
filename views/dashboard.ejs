<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="unlock-container">
            <button id="unlock-button" class="unlock-button"><i id="lock-icon" class="fas fa-lock"></i></button>
        </div>
        <div class="grid-container">
            <div class="grid-item">
                <a id="access-camera" href="/camera" class="action-button"><i class="fas fa-camera"></i></a>
                <p>Access Camera</p>
            </div>
            <div class="grid-item">
                <a id="reset-password" href="/reset-keypad" class="action-button"><i class="fas fa-key"></i></a>
                <p>Reset Keypad</p>
            </div>
        </div>
    </div>
    <script>
        const esp32Url = 'http://172.20.10.6'; // Replace <ESP32-IP> with your ESP32's IP address

        let isLocked = false;

        async function lockDoor() {
        const response = await fetch(`${esp32Url}/command?cmd=lock`);
        const result = await response.text();

        lockIcon.classList.remove('fa-lock-open');
        lockIcon.classList.add('fa-lock');

        document.getElementById('state').innerText = result;
        isLocked = true;
        }

        async function unlockDoor() {
        const response = await fetch(`${esp32Url}/command?cmd=unlock`);
        const result = await response.text();

        lockIcon.classList.remove('fa-lock');
        lockIcon.classList.add('fa-lock-open');

        document.getElementById('state').innerText = result;
        isLocked = false;
        }

        async function toggleLock() {
        if (isLocked) {
            await unlockDoor();
        } else {
            await lockDoor();
        }
        }

        async function getState() {
        const response = await fetch(`${esp32Url}/state`);
        const result = await response.text();
        document.getElementById('state').innerText = result;
        }
    </script>
</body>
</html>
